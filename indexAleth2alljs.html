<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	
	<title>Space Invaders : the game</title>
	<link rel="stylesheet" type="text/css" href="">
	<link rel="shortcut icon" href="logospacer.gif">
	<style type="text/css">
	@font-face {
		font-family: 'spaceage';
		src: url('spaceage.ttf');
	}
	body {
		
		/*max-width: 1000px;*/
		/*height: 700px;*/
	   /* margin: 0;
	   padding: 0;*/
	   overflow: hidden; /*pour ne pas sortir du cadre. no scroll*/

	}
	#conteneurgeneral {
		border: solid;
		background-image: url(starlight.gif);
		background-size: cover;
		height: 650px;
		width: 1010px;
		 margin-left: auto;
		margin-right: auto;
	}
/*	#conteneuraliens {
		display: flex;
		flex-direction: row;
		
		}*/

		h1 {
		background-image: -webkit-gradient( linear, left top, right top, color-stop(0, #f22), color-stop(0.15, #f2f), color-stop(0.3, #22f), color-stop(0.45, #2ff), color-stop(0.6, #2f2),color-stop(0.75, #2f2), color-stop(0.9, #ff2), color-stop(1, #f22) );
		background-image: gradient( linear, left top, right top, color-stop(0, #f22), color-stop(0.15, #f2f), color-stop(0.3, #22f), color-stop(0.45, #2ff), color-stop(0.6, #2f2),color-stop(0.75, #2f2), color-stop(0.9, #ff2), color-stop(1, #f22) );
		color:transparent;
		-webkit-background-clip: text;
		background-clip: text;
		font-size: 40px;
		
		text-align: center;
		font-family: 'spaceage';
		margin-bottom: 20px;
	}
		#conteneuraliens > div {
	/*	width: 50px;
	height: 50px;*/
	/*background-color: blue;*/
	/*margin: 3px;*/
	position: absolute;
	/*background-image: url(hero.png);*/
	/*background-size: cover;*/

}

#conteneurship > div {
	width: 100px;
	height: 50px;
		background-image: url(hero.png);
	background-size: cover;

	z-index: 20;
	/*margin: 100px 3px 3px 3px;*/
}
.aliens {
	width: 40px;
	height: 20px;
	/*background-color: blue;*/
}
.protectionBlocsClass * {
	width: 100px;
	height: 50px;
	position: absolute;
	top: 300px;
}
.conteneurprotection {
	position: relative;
	/*top: 600px;*/


}
</style>
</head>
<body>
	<h1>Space Invaders</h1>
	<div id="conteneurgeneral">
		<div id="conteneuraliens" style="position: relative">
		</div>
		<div id="conteneurprotection"></div>
		<div id="conteneurship">
			<div id="hero" style="position: absolute;"></div>
		</div>
		<button id="boutonUn" style="height: 30px"></button>
	</div>
	<!-- <script type="text/javascript" src="javAleth.js"></script> -->
	<script type="text/javascript">

		document.addEventListener('DOMContentLoaded', function (){ 


			let conteneurAlien = document.getElementById('conteneuraliens');
			let conteneurGeneral = document.getElementById('conteneurgeneral');
			let conteneurShip = document.getElementById('conteneurship');
			let boutonUn = document.getElementById('boutonUn');
			let conteneurProtection = document.getElementById('conteneurprotection');
			conteneurAlien.style.left = '10px';

			conteneurAlien.style.top = '10px';


			/**************** balancier gauche-droite *****************/
			// function boutonPlay() {

//pour faire apparaitre les aliens:
let rows = 5;
let columns = 10;
let badGuySpace = 50;
for (let i = 0; i < rows; i++) {
	for (let j = 0; j < columns; j++) {
		let aliens = document.createElement("div");
		aliens.className = 'aliens';
		aliens.style.top = badGuySpace * i + "px";
		aliens.style.left = badGuySpace * j + "px";
		aliens.style.backgroundImage = 'url(logospacer.gif)';
		aliens.style.backgroundSize = 'cover';


		conteneurAlien.appendChild(aliens);


	}
} 
let aliens = document.getElementsByClassName('aliens'); 


/* création blocs de défense*/



let rowsBlocs = 1;
let columnsBlocs = 4;
let protectionBlocsSpace = 200;
for (let k = 0; k < rowsBlocs; k++) {
	for (let l = 0; l < columnsBlocs; l++) {
		let protectionBlocs = document.createElement("div");
		protectionBlocs.className = 'protectionBlocsClass';
		protectionBlocs.style.top = 500 + "px";
		protectionBlocs.style.left = protectionBlocsSpace * l + 180 + "px";
		protectionBlocs.style.backgroundImage = 'url(protectionintacte.png)';
		protectionBlocs.style.backgroundSize = 'cover';


		conteneurProtection.appendChild(protectionBlocs);


	}
} 
let protectionBlocs = document.getElementsByClassName('protectionBlocsClass');


/*balancier aliens*/

var sens = 0;
var descend = 0
function MoveRightTheAliens() {
// var timeoutGoRight = setInterval("conteneurAlien.style.left = parseInt(carreUnLeft) + 122 + 'px'", 1000);
// var timeoutGoLeft = setTimeout("conteneurAlien.style.left = parseInt(carreUnLeft) - 122 + 'px'", 1000);
let carreUnTop = parseInt(conteneurAlien.style.top);
let carreUnLeft = parseInt(conteneurAlien.style.left);


			// carreUn = conteneurAlien.style.backgroundColor = "red";
			if (sens == 0) {
				// conteneurAlien.style.left = timeoutGoRight;
				var nextMoveUn = parseInt(carreUnLeft) + 25;
				
				if (nextMoveUn >= 585) {
					sens = 1; 
					conteneurAlien.style.top = (parseInt(carreUnTop) + 30 + "px");
				} else {
					conteneurAlien.style.left = nextMoveUn + "px";
				}
			} else if (sens ==1) {
				var nextMoveDeux = parseInt(carreUnLeft) - 25;
				if (nextMoveDeux <= 0) {
					sens = 0;
					conteneurAlien.style.top = (parseInt(carreUnTop) + 30 + "px");
				} else {
					conteneurAlien.style.left = parseInt(carreUnLeft) - 25 + "px";
				}

				
			}
			if (parseInt(conteneurAlien.style.top) > 550) {
				alert('game over!');

			}
		}
		setInterval(MoveRightTheAliens, 500);







		let heroShip = document.getElementById('hero');
		heroShip.style.top = '650px';
		heroShip.style.left = '500px';

		function moveTheHero(event){

			if (event.code == 'ArrowRight'){
				heroShip.style.left = (parseInt(heroShip.style.left) + 60 + "px");
			} else if (event.code == 'ArrowLeft') {
				heroShip.style.left = parseInt(heroShip.style.left) - 60 + "px";
			}
		} 

		document.addEventListener('keydown', moveTheHero);

// /******             misssiles           ****************/


function tirDeMissile(event) {
	if (event.code == 'Space') {
		var missile = document.createElement('div');
		missile.id = 'divDesmissiles';
		missile.style.width= '20px';
		missile.style.height= '28px';
				// missile.style.backgroundColor = 'black';
				missile.style.backgroundImage= "url(flamme.png)";
				missile.style.backgroundSize = "cover";
				missile.style.position = 'absolute';
				missile.style.top = '628px';
				// missile.style.top = setInterval('parseInt(missile.style.top) - 50 + "px"', 1000);
				missile.style.left = parseInt(heroShip.style.left) + 40 + 'px';;

				conteneurship.appendChild(missile);
				setInterval(function() {monteeDuMissile(missile)}, 200);

			}

		}
		
		document.addEventListener('keydown', tirDeMissile);





// 		/****** code importé *********/


function monteeDuMissile(quelMissile) {
	
	quelMissile.style.top = parseInt(quelMissile.style.top) - 50 + "px";
		

	quelMissile.y = quelMissile.style.top;
	quelMissile.height = quelMissile.style.height ;
	quelMissile.x = quelMissile.style.left;
	quelMissile.width = quelMissile.style.width ;

	for (var i = 0; i < protectionBlocs.length; i++) {
		protectionBlocs.length = i;
	}
 	protectionBlocs[0].x = parseInt(conteneurAlien.style.left) + parseInt(protectionBlocs[0].style.left);
	protectionBlocs[0].y = parseInt(conteneurAlien.style.top) + parseInt(protectionBlocs[0].style.top);
	protectionBlocs[0].height = protectionBlocs[0].style.height;
	protectionBlocs[0].width = protectionBlocs[0].style.width;
// for (var i = i; i < protectionBlocs.length; i++) {
// 	protectionBlocs[0] = protectionBlocs[0];
// }
	if (isCollide(quelMissile, protectionBlocs[0])) { 

	var variableDestroyProtection = 0;	
		if (variableDestroyProtection == 0){
			variableDestroyProtection = 1;
			protectionBlocs[0].style.backgroundImage= 'url(protectionbroken.png)';
		protectionBlocs[0].style.backgroundSize = 'cover';
			console.log(variableDestroyProtection);
		} else if (variableDestroyProtection == 1) {
			conteneurProtection.removeChild('protectionBlocs[0]');
			console.log(variableDestroyProtection);
		}
		
	// 	alert("t'y est presque");

	}

	// let aliens = document.getElementsByClassName('aliens');
	// aliens.style.left = badGuySpace * 10 + "px";
	// aliens.style.top = badGuySpace * 5 + "px";

	// aliens[0].x = parseInt(conteneurAlien.style.left) + parseInt(aliens.style.left);
	// aliens.y = parseInt(conteneurAlien.style.top) + parseInt(aliens.style.top);
	// aliens.height = aliens.style.height;
	// aliens.width = aliens.style.width;


	// if (isCollide(quelMissile, aliens[i])) {

	// 	for (var i = i; i < alien.length; i++) {

	// 		conteneurAlien.removeChild(aliens[i]);
	// 	}
	// }
	// console.log(alien[i])
		// boucle sur chaque alien - faire remove child plutôt que display none
		
	};

		function isCollide(a, b) {
			return !(
				((a.y + a.height) < (b.y)) ||
				(a.y > (b.y + b.height)) ||
				((a.x + a.width) < b.x) ||
				(a.x > (b.x + b.width))
				);
		}
// 	} 
// 	boutonUn.addEventListener('click', boutonPlay);
// console.log(boutonPlay);

// 		function destroyAliens() {
// // if (parseInt(conteneurAlien.style.left) == missile.style.left && conteneurAlien.style.top == conteneurAlien.style.top)

// }


});//domcontentloaded

</script>
</body>
</html>